<!DOCTYPE html>
<html>
<head>
    <title>HomeYantric</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div id="loading-overlay">
        <div class="spinner"></div>
    </div>
    <div id="main-container" class="container hidden">
        
        <!-- BRANDING HEADER -->
        <div class="hero-header">
            <div class="hero-core">
                <div class="hero-logo">
                    <svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
                      <rect x="5" y="5" width="110" height="70" rx="20" ry="20" fill="#3d4d24"/>
                      <path d="M25 20 V 60 M95 20 V 60 M25 40 H 95 M60 40 V 60" stroke="#cbd5c1" stroke-width="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <div class="hero-title">
                    <h1 id="brand-title">HomeYantric</h1>
                    <div class="hero-subtitle">Bed Controller</div>
                </div>
            </div>
            <div class="status-stack">
                <div class="status-text">
                    <div id="status-line-1" class="status-line hidden">Connecting...</div>
                    <div id="status-line-2" class="status-line"><i id="status-duration-icon" class="fas fa-running"></i> <span id="status-duration-text"></span></div>
                </div>
            </div>
        </div>

        <div class="tab-switch">
            <button id="tab-bed" class="tab-btn active" onclick="switchModule('bed')">
                <i class="fas fa-bed"></i>
                <span class="tab-label">Bed</span>
            </button>
            <button id="tab-tray" class="tab-btn" onclick="switchModule('tray')">
                <i class="fas fa-table"></i>
                <span class="tab-label">Tray</span>
            </button>
            <button id="tab-curtains" class="tab-btn" onclick="switchModule('curtains')">
                <i class="fas fa-bars"></i>
                <span class="tab-label">Curtains</span>
            </button>
        </div>

        <div id="bed-tab" class="tab-panel active">
            <div class="status">
                <div class="svg-container">
                    <svg class="svg-visualizer" viewBox="0 0 350 164">
                        <polygon id="bed-top-1" class="bed-base" points=""></polygon>
                        <polygon id="bed-top-2" class="bed-base" points=""></polygon>
                        <polygon id="bed-top-3" class="bed-base" points=""></polygon>
                        <polygon id="bed-top-4" class="bed-base" points=""></polygon>
                        <polygon id="vanish-bed-base" class="bed-base" points=""></polygon>
                        <polygon id="bed-base" class="bed-base" points=""></polygon>
                        <polygon id="bed-top" class="bed-base" points=""></polygon>
                        <rect id="vanish-element-0" class="vanish-rect" x="0" y="108" width="118" height="16" rx="2" ry="2"></rect>
                        <rect id="vanish-element-1" class="vanish-rect" x="122" y="108" width="48" height="16" rx="2" ry="2"></rect>
                        <rect id="vanish-element-2" class="vanish-rect" x="174" y="108" width="86" height="16" rx="2" ry="2"></rect>
                        <rect id="vanish-element-3" class="vanish-rect" x="264" y="108" width="86" height="16" rx="2" ry="2"></rect>
                        <polygon id="vanish-top-0" class="vanish-top" points=""></polygon>
                        <polygon id="vanish-top-1" class="vanish-top" points=""></polygon>
                        <polygon id="vanish-top-2" class="vanish-top" points=""></polygon>
                        <polygon id="vanish-top-3" class="vanish-top" points=""></polygon>
                        <line id="vanish-connector-0" class="vanish-connector" x1="0" y1="116" x2="0" y2="0"></line>
                        <line id="vanish-connector-1" class="vanish-connector" x1="118" y1="116" x2="0" y2="0"></line>
                        <line id="vanish-connector-2" class="vanish-connector" x1="122" y1="116" x2="0" y2="0"></line>
                        <line id="vanish-connector-3" class="vanish-connector" x1="170" y1="116" x2="0" y2="0"></line>
                        <line id="vanish-connector-4" class="vanish-connector" x1="174" y1="116" x2="0" y2="0"></line>
                        <line id="vanish-connector-5" class="vanish-connector" x1="260" y1="116" x2="0" y2="0"></line>
                        <line id="vanish-connector-6" class="vanish-connector" x1="264" y1="116" x2="0" y2="0"></line>
                        <line id="vanish-connector-7" class="vanish-connector" x1="350" y1="116" x2="0" y2="0"></line>
                        <rect id="mattress-element-0" class="visualizer-line" x="0" y="108" width="118" height="16" rx="2" ry="2"></rect>
                        <rect id="mattress-element-1" class="visualizer-line" x="122" y="108" width="48" height="16" rx="2" ry="2"></rect>
                        <rect id="mattress-element-2" class="visualizer-line" x="174" y="108" width="86" height="16" rx="2" ry="2"></rect>
                        <rect id="mattress-element-3" class="visualizer-line" x="264" y="108" width="86" height="16" rx="2" ry="2"></rect>
                        <foreignObject id="head-pos-text-container" class="position-text-container" x="-10" y="78">
                            <div id="head-pos-text" class="position-text-svg" style="text-align: left;">0s</div>
                        </foreignObject>
                        <foreignObject id="foot-pos-text-container" class="position-text-container" x="310" y="78">
                            <div id="foot-pos-text" class="position-text-svg" style="text-align: right;">0s</div>
                        </foreignObject>
                    </svg>
                </div>
            </div>

        <div id="bed-tab-content" class="btn-group tab-panel active">

            <div class="row" id="rocker-row">
                <div class="rocker-btn">
                    <button class="rocker-up control-btn" ontouchstart="sendCmd('HEAD_UP')" ontouchend="stopCmd(true)" onmousedown="sendCmd('HEAD_UP')" onmouseup="stopCmd(true)">
                        <i class="fas fa-arrow-up"></i>
                    </button>
                    <div class="rocker-label-inset">HEAD</div>
                    <button class="rocker-down control-btn" ontouchstart="sendCmd('HEAD_DOWN')" ontouchend="stopCmd(true)" onmousedown="sendCmd('HEAD_DOWN')" onmouseup="stopCmd(true)">
                        <i class="fas fa-arrow-down"></i>
                    </button>
                </div>
                <div class="rocker-btn">
                    <button class="rocker-up all-btn" ontouchstart="sendCmd('ALL_UP')" ontouchend="stopCmd(true)" onmousedown="sendCmd('ALL_UP')" onmouseup="stopCmd(true)">
                        <i class="fas fa-angles-up"></i>
                    </button>
                    <div class="rocker-label-inset">ALL</div>
                    <button class="rocker-down all-btn" ontouchstart="sendCmd('ALL_DOWN')" ontouchend="stopCmd(true)" onmousedown="sendCmd('ALL_DOWN')" onmouseup="stopCmd(true)">
                        <i class="fas fa-angles-down"></i>
                    </button>
                </div>
                <div class="rocker-btn">
                    <button class="rocker-up control-btn" ontouchstart="sendCmd('FOOT_UP')" ontouchend="stopCmd(true)" onmousedown="sendCmd('FOOT_UP')" onmouseup="stopCmd(true)">
                        <i class="fas fa-arrow-up"></i>
                    </button>
                    <div class="rocker-label-inset">FOOT</div>
                    <button class="rocker-down control-btn" ontouchstart="sendCmd('FOOT_DOWN')" ontouchend="stopCmd(true)" onmousedown="sendCmd('FOOT_DOWN')" onmouseup="stopCmd(true)">
                        <i class="fas fa-arrow-down"></i>
                    </button>
                </div>
            </div>
            
            <div class="row row-3-btn" id="stop-row">
                <button id="btn-flat" class="preset-btn flat-btn" onclick="sendCmd('FLAT', this)">
                    <svg class="preset-icon-svg" viewBox="0 0 24 18">
                        <polyline points="0,14 24,14"></polyline>
                    </svg>
                    <span>Flat</span>
                </button>
                <button class="stop-btn" onclick="stopCmd(true)">
                    <i class="fas fa-stop-circle"></i> <span>STOP</span>
                </button>
                <button id="btn-max" class="preset-btn max-btn" onclick="sendCmd('MAX', this)">
                    <svg class="preset-icon-svg" viewBox="0 0 24 18">
                        <polyline points="0,4 10,14 14,14 20,9 24,9"></polyline>
                    </svg>
                    <span>Max</span>
                </button>
            </div>
                                
            <div class="row row-3-btn">
                <button id="btn-zg" class="preset-btn custom-preset-btn" onclick="sendCmd('ZERO_G', this)">
                    <svg class="preset-icon-svg" viewBox="0 0 24 18">
                        <polyline id="zg-icon-line" points="0,14 24,14"></polyline>
                    </svg>
                    <span id="zg-label-text">Zero G</span>
                </button>
                <button id="btn-snore" class="preset-btn custom-preset-btn" onclick="sendCmd('ANTI_SNORE', this)">
                    <svg class="preset-icon-svg" viewBox="0 0 24 18">
                        <polyline id="snore-icon-line" points="0,14 24,14"></polyline>
                    </svg>
                    <span id="snore-label-text">Anti-Snore</span>
                </button>
                <button id="btn-legs" class="preset-btn custom-preset-btn" onclick="sendCmd('LEGS_UP', this)">
                    <svg class="preset-icon-svg" viewBox="0 0 24 18">
                        <polyline id="legs-icon-line" points="0,14 24,14"></polyline>
                    </svg>
                    <span id="legs-label-text">Legs Up</span>
                </button>
            </div>
            
            <div class="row row-3-btn">
                <button id="btn-p1" class="preset-btn custom-preset-btn" onclick="sendCmd('P1', this)">
                    <svg class="preset-icon-svg" viewBox="0 0 24 18">
                        <polyline id="p1-icon-line" points="0,14 24,14"></polyline>
                    </svg>
                    <span id="p1-label-text">P1</span>
                </button>
                <button id="btn-p2" class="preset-btn custom-preset-btn" onclick="sendCmd('P2', this)">
                    <svg class="preset-icon-svg" viewBox="0 0 24 18">
                        <polyline id="p2-icon-line" points="0,14 24,14"></polyline>
                    </svg>
                    <span id="p2-label-text">P2</span>
                </button>
                <button id="btn-set" class="util-btn" onclick="openSetModal()">
                    <i class="fas fa-cog"></i> <span>Set</span>
                </button>
            </div>          

        </div> </div> <div id="set-modal" class="modal-backdrop">
        <div class="settings-sheet">
            <div class="settings-header">
                <button class="settings-back" onclick="closeSetModal()"><i class="fas fa-chevron-left"></i></button>
                <div class="settings-title">Settings</div>
                <div class="settings-spacer"></div>
            </div>
            <div class="settings-body">

                <div class="settings-card">
                    <div class="settings-card-title">Presets</div>
                    <div class="settings-field">
                        <label for="preset-select">Preset</label>
                        <select id="preset-select" onchange="onModalDropdownChange()">
                            <option value="zg">Zero G</option>
                            <option value="snore">Anti-Snore</option>
                            <option value="legs">Legs Up</option>
                            <option value="p1">P1</option>
                            <option value="p2">P2</option>
                        </select>
                    </div>
                    <div class="settings-subhead">Label</div>
                    <div class="settings-field">
                        <input type="text" id="preset-label-input" placeholder="Type new label..." maxlength="10" oninput="onModalInputChange()">
                    </div>
                    <div class="settings-actions">
                        <button id="modal-save-label-btn" class="control-btn" onclick="savePresetLabel()">Rename</button>
                        <button id="modal-reset-label-btn" class="reset-btn ghost" onclick="resetPresetLabel()">Reset</button>
                    </div>
                    <div class="settings-subhead">Position</div>
                    <div class="settings-note" id="modal-pos-text">Head: 0s -> 0s, Foot: 0s -> 0s</div>
                    <div class="settings-actions">
                        <button id="modal-save-pos-btn" class="control-btn" onclick="savePresetPos()">Overwrite</button>
                        <button id="modal-reset-pos-btn" class="reset-btn ghost" onclick="resetPresetPos()">Reset</button>
                    </div>
                </div>

                <div class="settings-card">
                    <div class="settings-card-title">Look &amp; Feel</div>
                    <div class="settings-field">
                        <label for="style-select">Style</label>
                        <select id="style-select" onchange="onStyleChange()">
                            <option value="style-b">Olive Outline</option>
                            <option value="style-c">Circular Minimal</option>
                            <option value="style-a">Classic</option>
                        </select>
                    </div>
                    <div class="settings-field">
                        <label for="brand-select">Brand</label>
                        <select id="brand-select" onchange="onBrandChange()">
                            <option value="homeyantric">HomeYantric</option>
                        </select>
                    </div>
                </div>

                <div class="settings-card">
                    <div class="settings-card-title">Travel limits</div>
                    <div class="settings-field two-col">
                        <div>
                            <label for="limit-head-input">Head max (s)</label>
                            <input type="number" id="limit-head-input" min="5" max="60" step="1">
                        </div>
                        <div>
                            <label for="limit-foot-input">Foot max (s)</label>
                            <input type="number" id="limit-foot-input" min="5" max="60" step="1">
                        </div>
                    </div>
                    <div class="settings-actions single">
                        <button class="control-btn" onclick="saveLimits()">Save limits</button>
                    </div>
                </div>

                <div class="settings-card">
                    <div class="settings-card-title">Firmware update (OTA)</div>
                    <div class="settings-field">
                        <input type="file" id="ota-file-input" accept=".bin" onchange="onOtaFileChange()">
                        <div id="ota-status" class="small-text">Choose a .bin firmware file.</div>
                        <div class="ota-progress">
                            <div id="ota-progress-bar"></div>
                        </div>
                    </div>
                    <div class="settings-actions single">
                        <button id="ota-upload-btn" class="control-btn" onclick="uploadFirmware()">Upload &amp; Reboot</button>
                    </div>
                </div>

                <div class="settings-card danger">
                    <div class="settings-card-title">Network</div>
                    <div class="settings-note">Reset WiFi settings and reboot into setup mode.</div>
                    <div class="settings-actions single">
                        <button class="reset-btn" onclick="resetNetwork()"><i class="fas fa-wifi"></i> Reset Network Settings</button>
                        <button class="stop-btn ghost" onclick="closeSetModal()">Close</button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div id="tray-tab" class="tab-panel hidden">
        <div class="tray-card">
            <div class="tray-header">
                <h2>Side Tray</h2>
                <div id="tray-status-line" class="status-line">Ready</div>
            </div>
            <div class="tray-controls">
                <button class="control-btn" onclick="sendTrayCmd('TRAY_UP')"><i class="fas fa-arrow-up"></i> Up</button>
                <button class="control-btn" onclick="sendTrayCmd('TRAY_DOWN')"><i class="fas fa-arrow-down"></i> Down</button>
                <button class="stop-btn" onclick="sendTrayCmd('TRAY_STOP')"><i class="fas fa-stop-circle"></i> Stop</button>
            </div>
        </div>
    </div>

    <div id="curtains-tab" class="tab-panel hidden">
        <div class="tray-card">
            <div class="tray-header">
                <h2>Curtains</h2>
                <div id="curtain-status-line" class="status-line">Ready</div>
            </div>
            <div class="curtain-group">
                <h3>Dining</h3>
                <div class="curtain-row">
                    <div class="curtain-name">Side</div>
                    <div class="curtain-controls">
                        <button class="control-btn" onclick="sendCurtainCmd('dining_side','OPEN')">Open</button>
                        <button class="control-btn" onclick="sendCurtainCmd('dining_side','CLOSE')">Close</button>
                        <button class="stop-btn" onclick="sendCurtainCmd('dining_side','STOP')">Stop</button>
                    </div>
                </div>
                <div class="curtain-row">
                    <div class="curtain-name">Rear</div>
                    <div class="curtain-controls">
                        <button class="control-btn" onclick="sendCurtainCmd('dining_rear','OPEN')">Open</button>
                        <button class="control-btn" onclick="sendCurtainCmd('dining_rear','CLOSE')">Close</button>
                        <button class="stop-btn" onclick="sendCurtainCmd('dining_rear','STOP')">Stop</button>
                    </div>
                </div>
            </div>
            <div class="curtain-group">
                <h3>Living</h3>
                <div class="curtain-row">
                    <div class="curtain-name">Rear 1</div>
                    <div class="curtain-controls">
                        <button class="control-btn" onclick="sendCurtainCmd('living_rear1','OPEN')">Open</button>
                        <button class="control-btn" onclick="sendCurtainCmd('living_rear1','CLOSE')">Close</button>
                        <button class="stop-btn" onclick="sendCurtainCmd('living_rear1','STOP')">Stop</button>
                    </div>
                </div>
                <div class="curtain-row">
                    <div class="curtain-name">Rear 2</div>
                    <div class="curtain-controls">
                        <button class="control-btn" onclick="sendCurtainCmd('living_rear2','OPEN')">Open</button>
                        <button class="control-btn" onclick="sendCurtainCmd('living_rear2','CLOSE')">Close</button>
                        <button class="stop-btn" onclick="sendCurtainCmd('living_rear2','STOP')">Stop</button>
                    </div>
                </div>
            </div>
            <div class="curtain-group">
                <h3>Bedroom</h3>
                <div class="curtain-row">
                    <div class="curtain-name">Rear 1</div>
                    <div class="curtain-controls">
                        <button class="control-btn" onclick="sendCurtainCmd('bedroom_rear1','OPEN')">Open</button>
                        <button class="control-btn" onclick="sendCurtainCmd('bedroom_rear1','CLOSE')">Close</button>
                        <button class="stop-btn" onclick="sendCurtainCmd('bedroom_rear1','STOP')">Stop</button>
                    </div>
                </div>
                <div class="curtain-row">
                    <div class="curtain-name">Rear 2</div>
                    <div class="curtain-controls">
                        <button class="control-btn" onclick="sendCurtainCmd('bedroom_rear2','OPEN')">Open</button>
                        <button class="control-btn" onclick="sendCurtainCmd('bedroom_rear2','CLOSE')">Close</button>
                        <button class="stop-btn" onclick="sendCurtainCmd('bedroom_rear2','STOP')">Stop</button>
                    </div>
                </div>
                <div class="curtain-row">
                    <div class="curtain-name">Rear 3</div>
                    <div class="curtain-controls">
                        <button class="control-btn" onclick="sendCurtainCmd('bedroom_rear3','OPEN')">Open</button>
                        <button class="control-btn" onclick="sendCurtainCmd('bedroom_rear3','CLOSE')">Close</button>
                        <button class="stop-btn" onclick="sendCurtainCmd('bedroom_rear3','STOP')">Stop</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="alert-modal" class="modal-backdrop">
        <div class="modal-content">
            <h2 id="alert-title">Alert</h2>
            <p id="alert-message"></p>
            <button class="control-btn" onclick="closeCustomAlert()">OK</button>
        </div>
    </div>

    <div id="confirm-modal" class="modal-backdrop">
        <div class="modal-content">
            <h2 id="confirm-title">Confirm</h2>
            <p id="confirm-message"></p>
            <div class="modal-btn-group-row">
                <button class="stop-btn" onclick="closeCustomConfirm(false)">Cancel</button>
                <button class="control-btn" onclick="closeCustomConfirm(true)">OK</button>
            </div>
        </div>
    </div>

    <script src="bed-visualizer.js"></script>
    <script src="app.js"></script>
</body>
</html>
