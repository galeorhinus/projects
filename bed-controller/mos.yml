manifest_version: 2017-05-18
author: bed-controller-app
version: 1.9.0
platform: esp32

libs:
  # Core Mongoose OS libraries
  - origin: 'https://github.com/mongoose-os-libs/ca-bundle'
  - origin: 'https://github.com/mongoose-os-libs/rpc-uart'
  - origin: 'https://github.com/mongoose-os-libs/rpc-common'
  - origin: 'https://github.com/mongoose-os-libs/rpc-service-config'
  - origin: 'https://github.com/mongoose-os-libs/wifi'
  - origin: 'https://github.com/mongoose-os-libs/http-server'
  - origin: 'https://github.com/mongoose-os-libs/mjs'
  
  # Hardware libraries (Explicitly added, replacing js-demo-bundle)
  - origin: 'https://github.com/mongoose-os-libs/neopixel'
  - origin: 'https://github.com/mongoose-os-libs/adc'

# Configuration schema
config_schema:
  - ["wifi.sta.enable", "b", false, {title: "Enable WiFi station"}]
  - ["wifi.sta.ssid", "s", "", {title: "WiFi station SSID"}]
  - ["wifi.sta.pass", "s", "", {title: "WiFi station password"}]
  - ["rpc.uart.enable", "b", true, {title: "Enable RPC over UART"}]
  - ["http.port", "i", 8080, {title: "HTTP server port"}]
  
  # --- Persistent State Variables ---
  - ["state", "o", {title: "Persistent Motor Position"}]
  - ["state.head", "i", 0, {title: "Current Head Position (ms)"}]
  - ["state.foot", "i", 0, {title: "Current Foot Position (ms)"}]
  
  # --- Presets ---
  - ["state.zg_head", "i", 10000, {title: "ZeroG Head"}]
  - ["state.zg_foot", "i", 40000, {title: "ZeroG Foot"}]
  - ["state.zg_label", "s", "Zero G", {title: "ZeroG Label"}]
  - ["state.snore_head", "i", 10000, {title: "Snore Head"}]
  - ["state.snore_foot", "i", 0, {title: "Snore Foot"}]
  - ["state.snore_label", "s", "Anti-Snore", {title: "Snore Label"}]
  - ["state.legs_head", "i", 0, {title: "Legs Head"}]
  - ["state.legs_foot", "i", 43000, {title: "Legs Foot"}]
  - ["state.legs_label", "s", "Legs Up", {title: "Legs Label"}]
  - ["state.p1_head", "i", 0, {title: "P1 Head"}]
  - ["state.p1_foot", "i", 0, {title: "P1 Foot"}]
  - ["state.p1_label", "s", "P1", {title: "P1 Label"}]
  - ["state.p2_head", "i", 0, {title: "P2 Head"}]
  - ["state.p2_foot", "i", 0, {title: "P2 Foot"}]
  - ["state.p2_label", "s", "P2", {title: "P2 Label"}]

config_set:
  provision.btn_pin: 12

tags:
  - js

filesystem:
  - fs

conds:
  - when: mos.platform == "esp32"
    apply:
      build_vars:
        APP_SLOT_SIZE: 0x190000