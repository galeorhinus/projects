manifest_version: 2017-05-18
author: bed-controller-app
version: 1.3
platform: esp32

libs:
  # Core libraries from your working 'bed-controller-js'
  - origin: 'https://github.com/mongoose-os-libs/ca-bundle'
  - origin: 'https://github.com/mongoose-os-libs/rpc-uart'
  - origin: 'https://github.com/mongoose-os-libs/rpc-common'
  - origin: 'https://github.com/mongoose-os-libs/rpc-service-config'
  - origin: 'https://github.com/mongoose-os-libs/wifi'
  - origin: 'https://github.com/mongoose-os-libs/http-server'
  - origin: 'https://github.com/mongoose-os-libs/mjs'
  
  # This is the critical library that provides api_fmt.js, api_net.js, etc.
  - origin: 'https://github.com/mongoose-os-libs/js-demo-bundle'

# Configuration schema, can be minimal or based on your other project
config_schema:
  - ["wifi.sta.enable", "b", false, {title: "Enable WiFi station"}]
  - ["wifi.sta.ssid", "s", "", {title: "WiFi station SSID"}]
  - ["wifi.sta.pass", "s", "", {title: "WiFi station password"}]
  - ["rpc.uart.enable", "b", true, {title: "Enable RPC over UART"}]

  # --- Updated State Variables (Numbers) ---
  - ["state", "o", {title: "Persistent Motor Position (seconds from flat)"}]
  - ["state.head", "i", 0, {title: "Current Head Position (0 = flat)"}] # Changed to integer 'i', default 0
  - ["state.foot", "i", 0, {title: "Current Foot Position (0 = flat)"}] # Changed to integer 'i', default 0
  # --- End of State Variables ---
  - ["provision.timeout", "i", 0, {title: "Provisioning timeout (0=disabled)"}]

tags:
  - js

filesystem:
  - fs

conds:
  - when: mos.platform == "esp32"
    apply:
      build_vars:
        # Increase app size for ESP32
        APP_SLOT_SIZE: 0x190000

