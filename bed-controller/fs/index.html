<!DOCTYPE html>
<html>
<head>
    <title>Bed Controller</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Link to the new CSS file -->
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-bed"></i> Bed Control</h1>

        <!-- Visualizer Section -->
        <div class="status">
            <div class="svg-container">
                <svg class="svg-visualizer" viewBox="0 0 350 176">
                    <!-- The main bed frame base -->
                    <line id="bed-base-line" x1="0" y1="140" x2="350" y2="140"></line>
                    <!-- Bed Legs -->
                    <line class="bed-leg-line" x1="30" y1="140" x2="30" y2="164"></line>
                    <line class="bed-leg-line" x1="110" y1="140" x2="110" y2="164"></line>
                    <line class="bed-leg-line" x1="240" y1="140" x2="240" y2="164"></line>
                    <line class="bed-leg-line" x1="320" y1="140" x2="320" y2="164"></line>
                    <!-- Single Polyline for the entire "mattress" -->
                    <polyline id="mattress-line" class="visualizer-line" points="0,116 120,116 170,116 260,116 350,116"></polyline>
                    <!-- Position text elements -->
                    <foreignObject id="head-pos-text-container" class="position-text-container" x="-10" y="78">
                         <div id="head-pos-text" class="position-text-svg" style="text-align: left;">0s</div>
                    </foreignObject>
                    <foreignObject id="foot-pos-text-container" class="position-text-container" x="310" y="78">
                         <div id="foot-pos-text" class="position-text-svg" style="text-align: right;">0s</div>
                    </foreignObject>
                </svg>
            </div>
        </div>

        <!-- Button Section -->
        <div class="btn-group">

            <!-- Row for rocker labels and positions -->
            <div class="row rocker-label-row">
                <div class="rocker-label"><div>HEAD</div></div>
                <div class="rocker-label"><div>ALL</div></div>
                <div class="rocker-label"><div>FOOT</div></div>
            </div>

            <!-- Rocker Button Row -->
            <div class="row">
                <!-- Head Rocker -->
                <div class="rocker-btn">
                    <button class="rocker-up control-btn" ontouchstart="sendCmd('HEAD_UP')" ontouchend="stopCmd(true)" onmousedown="sendCmd('HEAD_UP')" onmouseup="stopCmd(true)">
                        <i class="fas fa-arrow-up"></i>
                    </button>
                    <button class="rocker-down control-btn" ontouchstart="sendCmd('HEAD_DOWN')" ontouchend="stopCmd(true)" onmousedown="sendCmd('HEAD_DOWN')" onmouseup="stopCmd(true)">
                        <i class="fas fa-arrow-down"></i>
                    </button>
                </div>
                <!-- All Rocker -->
                <div class="rocker-btn">
                    <button class="rocker-up all-btn" ontouchstart="sendCmd('ALL_UP')" ontouchend="stopCmd(true)" onmousedown="sendCmd('ALL_UP')" onmouseup="stopCmd(true)">
                        <i class="fas fa-angles-up"></i>
                    </button>
                    <button class="rocker-down all-btn" ontouchstart="sendCmd('ALL_DOWN')" ontouchend="stopCmd(true)" onmousedown="sendCmd('ALL_DOWN')" onmouseup="stopCmd(true)">
                        <i class="fas fa-angles-down"></i>
                    </button>
                </div>
                <!-- Foot Rocker -->
                <div class="rocker-btn">
                    <button class="rocker-up control-btn" ontouchstart="sendCmd('FOOT_UP')" ontouchend="stopCmd(true)" onmousedown="sendCmd('FOOT_UP')" onmouseup="stopCmd(true)">
                        <i class="fas fa-arrow-up"></i>
                    </button>
                    <button class="rocker-down control-btn" ontouchstart="sendCmd('FOOT_DOWN')" ontouchend="stopCmd(true)" onmousedown="sendCmd('FOOT_DOWN')" onmouseup="stopCmd(true)">
                        <i class="fas fa-arrow-down"></i>
                    </button>
                </div>
            </div>
            
            <!-- Stop -->
            <div class="row">
                <button class="stop-btn" style="flex-grow: 2; font-size: 16px;" onclick="stopCmd(true)">
                    <i class="fas fa-stop-circle"></i> STOP ALL MOTORS
                </button>
            </div>
            
            <!-- Presets -->
            <div class="row">
                <button id="btn-flat" class="preset-btn" style="font-size: 16px;" onclick="sendCmd('FLAT', this)">
                    <svg class="preset-icon-svg" viewBox="0 0 24 18">
                        <polyline points="0,14 24,14"></polyline>
                    </svg>
                    Flat
                </button>
                
                <!-- CHANGED: Converted to dynamic button -->
                <button id="btn-zg" class="preset-btn custom-preset-btn" style="font-size: 16px;" onclick="sendCmd('ZERO_G', this)">
                    <svg class="preset-icon-svg" viewBox="0 0 24 18">
                        <polyline id="zg-icon-line" points="0,14 24,14"></polyline>
                    </svg>
                    <span id="zg-label-text">Zero G</span>
                </button>
            </div>
            <div class="row">
                <!-- CHANGED: Converted to dynamic button -->
                <button id="btn-snore" class="preset-btn custom-preset-btn" style="font-size: 16px;" onclick="sendCmd('ANTI_SNORE', this)">
                    <svg class="preset-icon-svg" viewBox="0 0 24 18">
                        <polyline id="snore-icon-line" points="0,14 24,14"></polyline>
                    </svg>
                    <span id="snore-label-text">Anti-Snore</span>
                </button>
                <!-- CHANGED: Converted to dynamic button -->
                <button id="btn-legs" class="preset-btn custom-preset-btn" style="font-size: 16px;" onclick="sendCmd('LEGS_UP', this)">
                    <svg class="preset-icon-svg" viewBox="0 0 24 18">
                        <polyline id="legs-icon-line" points="0,14 24,14"></polyline>
                    </svg>
                    <span id="legs-label-text">Legs Up</span>
                </button>
            </div>

            <!-- Custom Preset Row -->
            <div class="row">
                <button id="btn-p1" class="preset-btn custom-preset-btn" style="font-size: 16px;" onclick="sendCmd('P1', this)">
                    <svg class="preset-icon-svg" viewBox="0 0 24 18">
                        <polyline id="p1-icon-line" points="0,14 24,14"></polyline>
                    </svg>
                    <span id="p1-label-text">P1</span>
                </button>
                <button id="btn-p2" class="preset-btn custom-preset-btn" style="font-size: 16px;" onclick="sendCmd('P2', this)">
                    <svg class="preset-icon-svg" viewBox="0 0 24 18">
                        <polyline id="p2-icon-line" points="0,14 24,14"></polyline>
                    </svg>
                    <span id="p2-label-text">P2</span>
                </button>
                <button id="btn-set" class="util-btn" style="font-size: 16px;" onclick="openSetModal()">
                    <i class="fas fa-cog"></i> Set
                </button>
            </div>

            <!-- Light -->
            <div class="row">
                <button class="light-btn" style="flex-grow: 2; font-size: 16px;" onclick="sendCmd('LIGHT_TOGGLE')">
                    <i class="fas fa-lightbulb"></i> Toggle Light
                </button>
            </div>

        </div> <!-- end btn-group -->
        
        <div class="status-line-container">
            <div id="status-line-1" class="status-line">Connecting...</div>
            <div id="status-line-2" class="status-line"></div>
        </div>

    </div> <!-- end container -->

    <!-- NEW: Advanced Modal for Setting Presets -->
    <div id="set-modal" class="modal-backdrop">
        <div class="modal-content">
            <h2>Edit Presets</h2>
            
            <div class="modal-input-group">
                <label for="preset-label-input">New Label (optional):</label>
                <input type="text" id="preset-label-input" placeholder="Type new label here..." maxlength="10">
            </div>
            
            <!-- Preset 1: "Zero G" -->
            <div class_ ="modal-preset-row">
                <span id="modal-label-zg">Zero G</span>
                <div class="modal-btn-group">
                    <button class="control-btn" onclick="savePresetPos('zg')">Save Position</button>
                    <button class="control-btn" onclick="savePresetLabel('zg')">Save Label</button>
                    <button class="reset-btn" onclick="resetPreset('zg')">Reset</button>
                </div>
            </div>
            
            <!-- Preset 2: "Anti-Snore" -->
            <div class="modal-preset-row">
                <span id="modal-label-snore">Anti-Snore</span>
                <div class="modal-btn-group">
                    <button class="control-btn" onclick="savePresetPos('snore')">Save Position</button>
                    <button class="control-btn" onclick="savePresetLabel('snore')">Save Label</button>
                    <button class="reset-btn" onclick="resetPreset('snore')">Reset</button>
                </div>
            </div>

            <!-- Preset 3: "Legs Up" -->
            <div class="modal-preset-row">
                <span id="modal-label-legs">Legs Up</span>
                <div class="modal-btn-group">
                    <button class="control-btn" onclick="savePresetPos('legs')">Save Position</button>
                    <button class="control-btn" onclick="savePresetLabel('legs')">Save Label</button>
                    <button class="reset-btn" onclick="resetPreset('legs')">Reset</button>
                </div>
            </div>

            <!-- Preset 4: "P1" -->
            <div class="modal-preset-row">
                <span id="modal-label-p1">P1</span>
                <div class="modal-btn-group">
                    <button class="control-btn" onclick="savePresetPos('p1')">Save Position</button>
                    <button class="control-btn" onclick="savePresetLabel('p1')">Save Label</button>
                    <button class="reset-btn" onclick="resetPreset('p1')">Reset</button>
                </div>
            </div>

            <!-- Preset 5: "P2" -->
            <div class="modal-preset-row">
                <span id="modal-label-p2">P2</span>
                <div class="modal-btn-group">
                    <button class="control-btn" onclick="savePresetPos('p2')">Save Position</button>
                    <button class="control-btn" onclick="savePresetLabel('p2')">Save Label</button>
                    <button class="reset-btn" onclick="resetPreset('p2')">Reset</button>
                </div>
            </div>
            
            <hr class="modal-divider">

            <button class="stop-btn" style="margin-top: 5px;" onclick="closeSetModal()">
                Close
            </button>
        </div>
    </div>

    <!-- Link to the new JS file -->
    <script src="app.js"></script>
</body>
</html>