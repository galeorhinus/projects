Wi-Fi Adjustable Bed ControllerThis project converts a standard adjustable bed (which uses a wired remote) into a "smart" bed, controllable via Wi-Fi from any device with a web browser. It runs on an ESP32 using Mongoose OS and serves a modern, responsive web UI that works perfectly on a phone.This project is designed for a specific hardware setup that allows the original wired remote and the new Wi-Fi controller to be used simultaneously, with relays acting as a transfer switch to prevent conflicts.(You should replace the image above with a docs/demo.gif of your app working!)FeaturesWeb Interface: Fully responsive, mobile-first UI to control the bed.Dual-Control Safe: Uses a transfer switch (4 relays) to safely switch control between the original wired remote and the ESP32. This prevents short circuits.Real-time Visualizer: A dynamic SVG bed graphic shows the head and foot positions in real-time.Position Tracking: Uses motor run-time to calculate and save the bed's position, even after a reboot.Standard Presets: Includes one-touch buttons for "Flat," "Zero G," "Anti-Snore," and "Legs Up."Custom Presets (P1 & P2):Save two custom head/foot positions with your own labels (e.g., "Reading", "TV").Buttons feature dynamic SVG icons that show the saved position's shape.Under-Bed Light: A toggle button for a separate light relay.Safe by Default: The system boots with the wired remote active. The ESP32 only takes control of the motors when a command is sent.Hardware RequirementsESP32 Module: An ESP32-WROVER was used for this project.Relay Modules:1x 8-Channel Relay Module (5V): Relays 1-4 are for motor control (Head Up/Down, Foot Up/Down). Relays 5-8 are for the transfer switch.1x 1-Channel Relay Module (5V): For the under-bed light.Power Supply: A 5V power supply to run the ESP32 and the relays. (The ESP32's 3.3V pin may not provide enough current for the transfer relays).Hookup Wires: For connecting the ESP32 GPIOs to the relay IN pins.Soldering Iron & Wires: For intercepting the motor control lines from the wired remote.How it Works: ArchitectureBackend (fs/init.js): A Mongoose OS JavaScript file runs on the ESP32. It handles all logic.Web Server (http-server): The ESP32 hosts a web server (on port 8080 by default) that serves the fs/index.html, fs/style.css, and fs/app.js files.Frontend (fs/app.js): All user interaction in the browser is handled by vanilla JavaScript.API (RPC): The frontend sends commands (e.g., "HEAD_UP") to the backend by calling RPC (Remote Procedure Call) endpoints (e.g., /rpc/Bed.Command).Polling (RPC): The frontend polls the /rpc/Bed.Status endpoint every 1 second to get the bed's current position, uptime, and saved preset data, which it uses to update the SVG visualizer.GPIO Control: The backend logic in fs/init.js translates RPC commands into GPIO signals to control the relays.Transfer Switch: Before moving a motor, fs/init.js first activates the four transfer relays. After the motor stops (either by a "STOP" command or a preset timer finishing), it deactivates them, returning control to the wired remote.Software & InstallationThis project is built for Mongoose OS. You must have the mos tool installed and working.Clone the Repository:git clone [https://github.com/YOUR_USERNAME/YOUR_REPO_NAME.git](https://github.com/YOUR_USERNAME/YOUR_REPO_NAME.git)
cd YOUR_REPO_NAME
Clean & Build:(This step is important to clear any local caches).rm -rf build deps
mos build --clean
Flash the Device:(Hold the "Boot" button on your ESP32 if it doesn't connect automatically).mos flash --port YOUR_PORT_HERE
(e.g., mos flash --port /dev/tty.usbserial-1440)Configure Wi-Fi:mos wifi YOUR_SSID YOUR_PASSWORD --port YOUR_PORT_HERE
Find Device IP:After flashing, the device will connect to your Wi-Fi. Find its IP address from your router's DHCP list or by listening to the mos console.Use the App:Open http://<YOUR_DEVICE_IP>:8080 in any web browser.Pin Configuration (Crucial!)All hardware pin settings are at the top of fs/init.js. You must edit these to match your wiring.VariableDefaultDescriptionRELAY_ON00 for active-LOW relays, 1 for active-HIGH. Change this first!RELAY_OFF11 for active-LOW relays, 0 for active-HIGH. Change this first!HEAD_UP_PIN22GPIO pin for the "Head Up" motor relay.HEAD_DOWN_PIN23GPIO pin for the "Head Down" motor relay.FOOT_UP_PIN18GPIO pin for the "Foot Up" motor relay.FOOT_DOWN_PIN19GPIO pin for the "Foot Down" motor relay.LIGHT_PIN27GPIO pin for the under-bed light relay.TRANSFER_PIN_132GPIO pin for the first transfer relay.TRANSFER_PIN_233GPIO pin for the second transfer relay.TRANSFER_PIN_325GPIO pin for the third transfer relay.TRANSFER_PIN_426GPIO pin for the fourth transfer relay.Motor CalibrationYou must also time your bed's motors to get accurate positions.Use a stopwatch. Run the "Head Up" command until the bed stops at its maximum height.Update HEAD_MAX_SECONDS in fs/init.js with this value (in seconds).Do the same for the foot and update FOOT_MAX_SECONDS.Re-flash the init.js file (mos put fs/init.js --port ...).LicenseThis project is licensed under the MIT License. See the LICENSE file for details.